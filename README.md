# 農業合同会社 Webサイト

人・技術・農業をつなぐプラットフォーム

## 📋 プロジェクトステータス

**現在**: 統合CMSアーキテクチャで稼働中、Firebase全面採用  
**公開サイト**: https://agricultural-llc.web.app  
**管理画面**: https://agricultural-llc.web.app/admin/

| 機能 | ステータス | 詳細 |
|------|-----------|------|
| 🌐 公開サイト | ✅ 稼働中 | Firebase Hosting |
| 📝 CMS管理画面 | ✅ 統合完了 | `/admin/` - SimpleMDE エディタ |
| 🗄️ データベース | ✅ 稼働中 | Firebase Realtime Database |
| 📁 ファイル管理 | ✅ 稼働中 | Firebase Storage |
| 🔐 認証システム | ✅ 稼働中 | Firebase Authentication |
| 🔄 CI/CD | ✅ 稼働中 | GitHub Actions → Firebase |

## 概要

農業合同会社の公式Webサイトです。農業DXの最前線から、持続可能な農業の未来を創造します。

## 主な機能

- 🌾 **会社情報** - 農業合同会社のビジョンとミッション
- 🤝 **つながる** - 農家・JA・行政との連携活動
- 📚 **農てっく!** - 農業DXに関する情報発信（ハイブリッドSSG+CSR）
- 📰 **ニュース** - 農業DXに関する最新情報と特集記事（ハイブリッドSSG+CSR）
- 📊 **事例紹介** - スマート農業の成功事例
- 📞 **お問い合わせ** - 無料相談フォーム
- 🔍 **キーワード検索** - サイト内コンテンツの全文検索
- ⚡ **SPA機能** - 高速ページ遷移と動的コンテンツ表示

## アーキテクチャ

このプロジェクトは**統合CMSアーキテクチャ**を採用しています：

- **統合システム** (本リポジトリ): サイト配信 + CMS管理機能
- **Firebase連携**: Database + Storage + Auth の完全統合
- **リアルタイム更新**: 管理画面での編集が即座にサイトに反映
- **シンプル運用**: 単一リポジトリで完結する保守性

## 技術スタック

### Frontend
- **フレームワーク**: Astro v5.12.8
- **スタイリング**: Tailwind CSS
- **UIコンポーネント**: React
- **検索機能**: Fuse.js
- **開発言語**: TypeScript
- **エディタ**: SimpleMDE (Markdown)

### Backend & Infrastructure
- **ホスティング**: Firebase Hosting
- **データベース**: Firebase Realtime Database  
- **ファイルストレージ**: Firebase Storage
- **認証**: Firebase Authentication
- **サーバーレス**: Firebase Functions v2
- **CDN**: Firebase CDN統合
- **CI/CD**: GitHub Actions
- **フォーム**: SSGform
- **アーキテクチャ**: ハイブリッドSSG+CSR

### Content Management
- **CMS**: 統合管理画面 (`/admin/`)
- **エディタ**: SimpleMDE (streamlined single-pane view)
- **リンクカード**: Firebase Functions + オフラインフォールバック
- **画像管理**: Firebase Storage (drag & drop)
- **リアルタイム**: Firebase Database sync

### アーキテクチャ詳細

**ハイブリッドSSG+CSR実装**:
- **静的生成**: 基本ページはSSGで高速配信
- **動的レンダリング**: ニュース・農てっくページはCSRでリアルタイム更新
- **SPA機能**: ページ遷移時の高速ナビゲーション
- **Firebase CDN**: モジュールの効率的な読み込み

**統合CMSアーキテクチャ**:
- **統合システム** (本リポジトリ): サイト配信 + CMS管理機能
- **Firebase連携**: Database + Storage + Auth の完全統合
- **リアルタイム更新**: 管理画面での編集が即座にサイトに反映
- **シンプル運用**: 単一リポジトリで完結する保守性

### パフォーマンス最適化

**ハイブリッドSSG+CSR実装**:
- **初回読み込み**: SSGによる高速静的配信
- **動的更新**: CSRによるリアルタイムコンテンツ表示
- **SPA機能**: ページ遷移時の高速ナビゲーション
- **Firebase CDN**: モジュールの効率的な読み込み

**技術詳細**:
詳細な実装内容については [`docs/TECHNICAL_IMPLEMENTATION.md`](./docs/TECHNICAL_IMPLEMENTATION.md) を参照してください。

## 開発環境のセットアップ

### 必要要件

- Node.js v20.15.0以上
- npm v10.9.0以上

### インストール

```bash
# リポジトリのクローン
git clone https://github.com/Agricultural-LLC/web.git
cd web

# 依存関係のインストール
npm install
```

### 開発サーバーの起動

```bash
# 開発サーバーを起動
npm run dev
```

http://localhost:4321/web/ でアクセス可能です。

### ビルドとプレビュー

```bash
# プロダクションビルド
npm run build

# ビルド結果のプレビュー
npm run preview
```

### その他のコマンド

```bash
# コードフォーマット
npm run format

# 型チェック
npx tsc --noEmit
```

## プロジェクト構造

```
src/
├── assets/        # 画像・アセット
│   ├── agriculture/  # 農業関連画像
│   └── backgrounds/  # 背景画像
├── components/    # Astro/Reactコンポーネント
│   ├── admin/     # CMS管理画面
│   ├── base/      # 基本レイアウト
│   ├── agritech/  # 農てっく!関連
│   ├── common/    # 共通コンポーネント
│   ├── home/      # ホームページ専用
│   └── search/    # 検索機能
├── content/       # 静的コンテンツ（Markdown）
│   ├── about/     # 会社概要
│   └── home/      # トップページ
├── lib/           # ユーティリティ関数
│   ├── cms/       # CMS機能
│   ├── firebase/  # Firebase統合
│   └── firebaseLoader.ts  # データローダー
├── pages/         # ページルーティング
│   ├── admin/     # CMS管理画面
│   ├── api/       # APIエンドポイント
│   ├── index.astro    # トップページ
│   ├── about.astro    # 会社概要
│   ├── connect.astro  # つながる
│   ├── cases.astro    # 事例紹介
│   ├── contact.astro  # お問い合わせ
│   ├── agritech/    # 農てっく!（ハイブリッドSSG+CSR）
│   └── news/      # ニュース（ハイブリッドSSG+CSR）
├── styles/        # グローバルスタイル
└── types/         # TypeScript型定義
```

## デプロイ

### Firebase Hosting（現在使用中）

GitHub Actionsを使用した自動デプロイが設定されています。
`main`ブランチへのプッシュで自動的にFirebase Hostingにデプロイされます。

**本番URL**: https://agricultural-llc.web.app

### 開発ブランチ戦略

- `main` - 本番環境（自動デプロイ対象）
- `dev` - 開発環境（レビュー用）
- `feature/*` - 機能開発用ブランチ

## カスタマイズガイド

### 会社情報の更新

`src/pages/about.astro` を編集してください。

### ニュース記事の管理

#### ニュース機能の概要

ニュース機能により、農業DXに関する最新情報、お知らせ、特集記事などを管理・公開できます。

**機能特徴**:
- **優先度設定**: 記事の表示順序を制御
- **特集フラグ**: トップページに特集記事として表示
- **外部リンク対応**: 外部サイトの記事も掲載可能
- **閲覧数カウント**: 記事ごとの閲覧数を自動集計
- **カテゴリ・タグ分類**: 多角的な記事分類と検索

**管理画面での操作**:
1. `/admin/news/`で記事一覧を確認
2. 「新しいニュースを作成」で新規作成
3. 記事編集画面で以下を設定:
   - タイトル、説明、本文（マークダウン対応）
   - 優先度（数値が大きいほど上位表示）
   - 特集フラグ（トップページ表示用）
   - 外部リンク（外部記事の場合）
   - カテゴリ・タグ
4. 下書き保存または公開を選択

### 農てっく!記事の管理

#### CMS管理画面へのアクセス方法

**管理画面URL**: https://agricultural-llc.web.app/admin/

**ログイン方法**:
1. 上記URLにアクセス
2. Firebase Authenticationによる認証が必要
3. 事前に登録されたメールアドレス・パスワードでログイン
4. 認証成功後、ダッシュボードにリダイレクト

**主要エンドポイント**:
- `/admin/` - 管理ダッシュボード
- `/admin/agritech/` - 農てっく!記事一覧・管理
- `/admin/agritech/edit/` - 記事編集画面（新規作成・既存編集）
- `/admin/news/` - ニュース記事一覧・管理
- `/admin/news/edit/` - ニュース編集画面（新規作成・既存編集）

#### CMS機能詳細

**📝 記事編集機能**:
- **SimpleMDEエディタ**: マークダウン記法対応のリッチエディタ
- **ライブプレビュー**: リアルタイムでマークダウンのレンダリング結果を確認
- **シングルペイン表示**: モバイル対応の簡潔なUI設計

**🖼️ 画像管理**:
- **ドラッグ&ドロップアップロード**: Firebase Storageに直接アップロード
- **自動最適化**: CDN経由での高速画像配信
- **即座にMarkdownに挿入**: アップロード完了と同時にエディタに`![](url)`形式で挿入

**🔗 強化されたリンクカード機能**:
- **記法**: `[linkcard:https://example.com]`
- **Firebase Functions統合**: サーバーサイドでメタデータ取得（本番環境）
- **オフライン完全対応**: ネットワーク問題時も高品質なカード生成
- **日本サイト特別対応**: GitHub・YouTube・Qiita・Zenn・note.com等の専用認識
- **プログレッシブエンハンスメント**: 段階的な品質向上でUX最適化
- **3秒タイムアウト**: パフォーマンス重視の設計
- **美しいUI**: 角丸・ホバー効果・ダークモード・アニメーション対応
- **堅牢なエラーハンドリング**: 全てのエラーケースで適切なフォールバック

**📂 コンテンツ分類**:
- **カテゴリ**: 記事の主分類（例：技術解説、事例紹介、ニュース）
- **タグ**: 詳細な分類・キーワード（例：IoT、ドローン、北海道）
- **フィルタリング**: カテゴリ・タグ別の記事一覧表示

**💾 公開管理**:
- **下書き機能**: `draft: true`で非公開状態での編集・保存
- **即座反映**: 公開設定での保存後、サイトにリアルタイム反映
- **Firebase Database**: JSON形式での堅牢なデータ管理

#### 記事作成の具体的手順

1. **ログイン**: `/admin/`でFirebase認証
2. **記事一覧**: `/admin/agritech/`で既存記事の確認
3. **新規作成**: 「新しい記事を作成」ボタンをクリック
4. **基本情報入力**:
   - タイトル（必須）
   - スラッグ（URL用、自動生成可）
   - 説明文（SEO用）
   - 公開日
5. **コンテンツ編集**:
   - SimpleMDEエディタでマークダウン記述
   - 画像のドラッグ&ドロップ
   - リンクカード記法の活用
6. **メタデータ設定**:
   - カテゴリ選択（複数可）
   - タグ追加（自由入力）
   - アイキャッチ画像設定
7. **プレビュー確認**: エディタ右側でリアルタイムプレビュー
8. **保存・公開**:
   - 「下書き保存」: 非公開での一時保存
   - 「公開」: 即座にサイトに反映

#### 技術仕様

**認証システム**: Firebase Authentication（メール/パスワード方式）
**データベース**: Firebase Realtime Database（JSON構造）
**ファイルストレージ**: Firebase Storage（CDN対応）
**エディタ**: SimpleMDE v2.18.0
**API連携**: 
- `/api/link-preview` - リンクカードメタデータ取得
- Firebase Functions - 本番環境でのサーバーサイド処理

### 事例の追加

`src/pages/cases.astro` のcases配列に新しい事例オブジェクトを追加してください。

### お問い合わせフォームの設定

`src/pages/contact.astro` のSSGformエンドポイントを適切に設定してください。

## パフォーマンス目標

- ページ読み込み時間: 0.5秒以内（SSGによる高速配信）
- SPA遷移時間: 0.2秒以内（CSRによる高速ナビゲーション）
- PageSpeed Insights: 95点以上
- SEO: 地域検索上位表示（3-6ヶ月以内）
- Firebase CDN: グローバル高速配信

## 最近のアップデート

### 2025年10月21日 - ハイブリッドSSG+CSR実装とSPA機能完成
- 🚀 **ハイブリッドSSG+CSR実装** - 静的サイト生成とクライアントサイドレンダリングの統合
- ⚡ **SPA機能実装** - ニュースと農てっくページでの高速ナビゲーション
- 🔧 **Firebase CDN統合** - パフォーマンス最適化とモジュール読み込み改善
- 🛡️ **セキュリティ強化** - コード品質改善とセキュリティ脆弱性対策
- 📚 **技術記事追加** - ハイブリッド実装の詳細ドキュメント作成
- 🎨 **UI/UX改善** - ニュースコンポーネントのレイアウト最適化
- 🔄 **SPAコントローラー再構築** - 安定した動的コンテンツ表示
- 🐛 **バグ修正** - 重複定数、正規表現、イベントバインディングの修正
- 🔄 **Firebase App再利用** - アプリケーションインスタンスの最適化
- 📱 **レスポンシブ改善** - モバイル・タブレット・デスクトップでの最適表示

### 2025年09月28日 - ニュースCMS機能実装完了
- 📰 **ニュース管理システム** - Firebase連携による完全なニュースCMS機能
- ✨ **特集記事機能** - トップページに特集記事を優先表示
- 🔢 **優先度管理** - 記事の表示順序を柔軟に制御
- 📊 **閲覧数カウント** - 記事ごとの閲覧数を自動集計
- 🔗 **外部リンク対応** - 外部サイトの記事も統合管理可能
- 🎨 **デザイン統一** - 他コンポーネントと調和する透過背景・角丸デザイン
- 📱 **レスポンシブ対応** - モバイル・タブレット・デスクトップで最適表示

### 2025年09月04日 - 強化されたリンクカード機能実装完了
- ⚡ **高度なリンクカード機能** - Firebase Functions API フォールバック付きの堅牢な実装
- 🌐 **オフライン完全対応** - ネットワーク問題時も美しいカード生成
- 🇯🇵 **日本サイト特別対応** - Qiita・Zenn・note.comの専用認識機能
- 🎨 **美しいUI実装** - 角丸・ホバー効果・ダークモード完全対応
- ⏱️ **3秒タイムアウト** - パフォーマンス最適化されたAPI呼び出し
- 🛠️ **エラーハンドリング強化** - 全シナリオでの適切なフォールバック
- 📊 **技術詳細ドキュメント** - `docs/TECHNICAL_IMPLEMENTATION.md` に完全な実装記録を追加

### 2025年09月04日 - 緊急修正完了（本番エラー対応）
- 🚨 **Firebase設定エラー解決** - 全管理画面にフォールバック値追加、本番での設定未定義問題を完全解決
- 🚨 **農てっく!コンテンツ表示修正** - firebaseLoader.tsの設定不備を修正、記事一覧の空表示問題を解決
- ✅ **リンクカード機能基本実装** - メタデータ自動取得機能の実装
- ✅ **管理画面の安定稼働** - `/admin/`, `/admin/agritech/`, `/admin/agritech/edit/`の全エンドポイントで正常動作確認
- 📚 **ドキュメント大幅更新** - CMS機能詳細、ログイン方法、技術仕様を詳細に記載

### 2025年09月04日 - エディター改善とリンクカード機能追加
- ✅ **リンクカード機能実装** - `[linkcard:url]`構文でWebページプレビューを自動生成
- ✅ **エディター簡素化** - 2分割モードを廃止し、使いやすいシングルペイン表示に変更
- ✅ **TypeScriptエラー修正** - EntryHeader.astroコンポーネントのデータ構造エラーを解決
- ✅ **コードリファクタリング** - 不要なコード削除とドキュメント更新

### Firebase統合CMS完成（2025年09月04日）
- ✅ **統合CMSアーキテクチャ完了** - Firebase Database + Storage + Auth
- ✅ **SimpleMDEエディタ導入** - ライブプレビュー付きマークダウン編集
- ✅ **リアルタイム更新システム** - 編集内容が即座にサイトに反映
- ✅ **画像管理システム** - ドラッグ&ドロップでFirebase Storage連携
- ✅ **コードスニペット修正** - ライト/ダークモードの色コントラスト改善
- ✅ **ドキュメント整理完了** - 不要ファイル削除とREADME最新化

## トラブルシューティング

### Vite最適化エラーの場合

```bash
rm -rf node_modules/.vite .astro
npm install
npm run dev
```

### TypeScriptエラーの確認

```bash
npx tsc --noEmit
```

## ライセンス

© 2024 農業合同会社 All rights reserved.

## お問い合わせ

- **代表社員**: 藤井 洋平
- **業務執行社員**: 新藤 洋介
- **所在地**: 〒060-0807 北海道札幌市北区北7条西4丁目1番地1
- **ウェブサイト**: https://agricultural-llc.web.app

---

🤖 このプロジェクトは[Claude Code](https://claude.ai/code)を使用して開発・保守されています。