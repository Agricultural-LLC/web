---
import BaseLayout from "@components/base/BaseLayout.astro";
import LoginForm from "@components/admin/LoginForm";
import { Toaster } from 'react-hot-toast';

const title = "Admin Login - Agricultural CMS";
const description = "Login to the Agricultural CMS Management System";
---

<BaseLayout title={title} description={description}>
  <LoginForm client:load />
  <Toaster 
    client:load
    position="top-right"
    toastOptions={{
      duration: 4000,
      style: {
        background: '#363636',
        color: '#fff',
      },
    }}
  />
</BaseLayout>

<script>
  // Check if already authenticated
  fetch('/api/auth/me', {
    credentials: 'include'
  })
  .then(response => response.json())
  .then(data => {
    if (data.user) {
      // User is already authenticated, redirect to dashboard
      window.location.href = '/admin';
    }
  })
  .catch(() => {
    // Not authenticated, stay on login page
  });
</script>